<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Créditos TurnoX</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#eee; }
  header { display:flex; justify-content:space-between; align-items:center; background:#ddd; padding:10px; }
  header .logo { font-weight:bold; color:#4b2a72; }
  header button { background:#444; color:#fff; border:none; padding:8px 15px; cursor:pointer; border-radius:4px; }
  .container { padding:20px; }
  label { display:block; margin:10px 0; }
  input[type=number] { width:60px; padding:5px; }
  button { padding:8px 15px; cursor:pointer; border-radius:4px; background:#4b2a72; color:#fff; border:none; margin-top:10px; }
  #linkPago { margin-top:15px; }
</style>
</head>
<body>
  <header>
    <div class="logo">TurnoX</div>
    <button onclick="volverPanel()">Volver al Panel</button>
  </header>

  <div class="container">
    <h2>Gestión de Créditos</h2>
    <p>Créditos actuales: <b id="creditosActuales">0</b></p>
    <label>
      Cantidad a comprar:
      <input type="number" id="cantidadCreditos" min="1" value="1">
    </label>
    <button onclick="comprarCreditos()">Comprar Créditos</button>
    <div id="linkPago"></div>
  </div>

<script>
  // ---------- CONFIG ----------
  let username = "";
  let userId = "";

  // ---------- FUNCIONES ----------
  function init(userData) {
    username = userData.username;
    userId = userData.userId;
    cargarCreditos();
  }

  function cargarCreditos() {
    google.script.run.withSuccessHandler(function(creditos){
      document.getElementById("creditosActuales").innerText = creditos || 0;
    }).getCreditos(username);
  }

  function comprarCreditos() {
    const cantidad = parseInt(document.getElementById("cantidadCreditos").value);
    if (isNaN(cantidad) || cantidad <= 0) { alert("Cantidad inválida"); return; }

    google.script.run.withSuccessHandler(function(init_point){
      document.getElementById("linkPago").innerHTML = `<a href="${init_point}" target="_blank">Ir a pagar ${cantidad} créditos</a>`;
    }).crearPreferencia(username, cantidad);
  }

  function volverPanel() {
    google.script.host.close(); // cierra la ventana si se abrió como modal, o redirigir
  }
</script>
</body>
</html>
