<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pago Exitoso</title>
<style>
  body { font-family: Arial; text-align:center; padding:50px; }
  h2 { color: green; }
</style>
</head>
<body>
<h2>✅ ¡Pago realizado con éxito!</h2>
<p>Estamos acreditando tus créditos...</p>

<script>
const params = new URLSearchParams(window.location.search);
const externalRef = params.get('external_reference');

if(externalRef){
  const [username, cantidadStr] = externalRef.split("|");
  const cantidad = parseInt(cantidadStr, 10);

  fetch(`https://script.google.com/macros/s/AKfycbxhH4xPu4hhu3hD63AWz1LSMzq6exTSjFB7roCpwQZSFAN3IDtwRJY7b3X3MphgLzql/exec?action=sumaCreditos&username=${username}&cantidad=${cantidad}`)
    .then(res => res.text())
    .then(() => {
      document.body.innerHTML += "<p>Créditos sumados correctamente.</p>";
      setTimeout(()=> window.close(), 2000);
    })
    .catch(err => {
      document.body.innerHTML += "<p>⚠ Error al sumar créditos.</p>";
      console.error(err);
    });
}
</script>
</body>
</html>
